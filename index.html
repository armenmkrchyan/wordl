<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8" />
  <meta property="og:title" content="Wordle ๐ฆ๐ฒ" />
  <meta property="og:description" content="ิณีธึีทีกีฏีฅึ ึึีพีก ีขีกีผีจ" />
  <meta property="og:image" content="wordle.png" />
  <meta property="og:url" content="https://wordle.am" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Wordle ๐ฆ๐ฒ">
  <meta property="og:locale" content="hy_AM">
  <meta name="keywords" content="Wordle, ีีกีตีฅึีฅีถ, ิฝีกีฒ, ิฒีกีผ, ิฒีกีผีกีญีกีฒ, Armenian Wordle, ีึีพีก ีขีกีผ, Armblog, Armen Mkrtchyan">
  <meta itemprop="image" content="https://wordle.am/wordle.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="author" content="Armen Mkrtchyan">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Wordle ๐ฆ๐ฒ">
  <meta name="twitter:description" content="ิณีธึีทีกีฏีฅึ ึึีพีก ีขีกีผีจ">
  <meta name="twitter:image" content="https://wordle.am/wordle.png">
  <meta name="twitter:url" content="https://wordle.am">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <title>Wordle ๐ฆ๐ฒ</title>
  <style>
    /* --- Global Reset & Box Sizing --- */
    html {
        box-sizing: border-box;
        height: 100%; /* Ensure html takes full height */
        overflow-y: auto; /* Allow scrolling if content exceeds viewport */
    }
    *, *:before, *:after {
        box-sizing: inherit;
    }

    html, body {
        min-height: 100%; /* Ensure body can fill viewport */
        margin: 0;
        padding: 0; /* Ensure no default padding */
    }
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column; /* Stack children vertically */
      align-items: center; /* Center children horizontally */
      transition: background 0.3s, color 0.3s;
      background-color: var(--bg-color, #fff);
      color: var(--text-color, #000);
    }

    :root {
        --bg-color: #fff;
        --text-color: #000;
        --tile-border-empty: #aaa;
        --tile-border-filled: #666;
        --key-bg: #d3d6da;
        --key-text: #1a1a1b;
        --correct-bg: #538d4e;
        --present-bg: #b59f3b;
        --absent-bg: #3a3a3c;
        --delete-key-bg: #dc3545; /* Red */
        --enter-key-bg: #538d4e; /* Green */
        --tile-text-light: #000;
        --tile-text-dark: #fff;
        --link-color: #007bff;
        --popup-bg: #f8f9fa;
        --popup-text: #212529;
        --popup-border: #dee2e6;
        --popup-overlay-bg: rgba(0, 0, 0, 0.5);
        --popup-close-color: #6c757d;
        --popup-link-hover-bg: #e9ecef;
    }

    .main-content {
        flex: 1 1 auto; /* Allows growing and shrinking, takes available space */
        width: 100%;
        display: flex;
        flex-direction: column; /* Stack children vertically */
        align-items: center; /* Center children horizontally */
        max-width: 550px; /* Max width for the main content area */
        margin-left: auto;
        margin-right: auto;
        padding-left: 5px;
        padding-right: 5px;
        padding-bottom: 10px; /* Added some padding to the bottom of main-content */
        /* Ensure main-content aligns children even if they don't fill the width */
        align-self: center;
        position: relative; /* Needed for absolute positioning of child buttons */
    }

    .header-container {
        display: flex;
        align-items: baseline; /* Align title and game number */
        justify-content: center;
        flex-wrap: wrap; /* Allow wrapping on very small screens */
        gap: 0.5em; /* Space between title and game number */
        margin-top: 10px;
        margin-bottom: 2px;
        position: relative; /* For absolute positioning of buttons below */
        width: 100%; /* Take full width to contain elements */
    }

    h1 {
      /* Removed margins, handled by header-container */
      margin: 0;
      font-size: 1.5rem;
      white-space: nowrap;
    }

    #game-number-display {
        font-size: 0.9rem;
        font-weight: bold;
        color: var(--link-color);
        cursor: pointer;
        text-decoration: none;
        border-bottom: 1px dashed var(--link-color);
        margin-left: 5px; /* Space from title */
        white-space: nowrap;
    }
    #game-number-display:hover {
        text-decoration: none;
        border-bottom-style: solid;
    }
    .dark #game-number-display {
        color: var(--link-color); /* Keep link color distinct in dark mode */
        border-bottom-color: var(--link-color);
    }

    .subtitle {
        width: 100%; /* Ensure subtitle takes full width */
        text-align: center; /* Center subtitle text */
        font-size: 0.9rem;
        color: #777;
        margin-top: 0;
        margin-bottom: 5px;
    }
    .dark .subtitle {
        color: #aaa;
    }
     .subtitle a {
        color: inherit; /* Inherit color from subtitle */
        /* Removed text-decoration: none; */
     }
     .subtitle a:hover {
        text-decoration: underline; /* Keep underline on hover */
     }


    .board-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%; /* Board container takes full width of main-content */
        /* Removed max-width here - JS will control it */
        /* max-width: 350px; */
        margin: 8px 0; /* Keep vertical margins */
        flex: 1 1 auto; /* Allow board container to grow/shrink within main-content */
        min-height: 0; /* Allow flex item to shrink below content size */
    }

    .board {
      display: grid;
      grid-template-rows: repeat(6, 1fr);
      grid-gap: 4px;
      width: 100%; /* Board takes full width of its container */
      /* The height will be determined by width due to tile aspect ratio */
    }

    .row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-gap: 4px;
    }

    .tile {
      width: 100%;
      aspect-ratio: 1 / 1;
      border: 2px solid var(--tile-border-empty);
      font-size: clamp(1.5rem, 6vw, 2rem);
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-transform: lowercase;
      color: var(--tile-text-light);
      background-color: var(--bg-color);
      transition: background-color 0.3s, border-color 0.3s;
    }
    .tile > div {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        color: inherit;
    }
    .tile.filled {
        border-color: var(--tile-border-filled);
    }
    .tile.correct { background-color: var(--correct-bg); color: var(--tile-text-dark); border-color: var(--correct-bg); }
    .tile.present { background-color: var(--present-bg); color: var(--tile-text-dark); border-color: var(--present-bg); }
    .tile.absent { background-color: var(--absent-bg); color: var(--tile-text-dark); border-color: var(--absent-bg); }

    #keyboard {
      flex-shrink: 0; /* Prevent keyboard from shrinking */
      width: 100%;
      max-width: 550px; /* Align keyboard with main content */
      margin-left: auto;
      margin-right: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 0 3px;
      margin-top: 5px;
      margin-bottom: 20px; /* Changed bottom margin to 20px */
      align-self: center; /* Center keyboard horizontally */
    }

    #keyboard-top-row {
        display: grid;
        /* Make Enter and Delete columns equal size */
        grid-template-columns: 1fr 1fr;
        gap: 3px;
    }

    #keyboard-main-grid {
        display: grid;
        /* Default to Alphabetical grid columns, overridden by data attribute */
        grid-template-columns: repeat(8, 1fr);
        gap: 3px;
    }

    /* Specific grid columns for Phonetic layout main grid */
    body[data-keyboard-layout="phonetic"] #keyboard-main-grid {
         grid-template-columns: repeat(10, 1fr); /* Phonetic layout rows have 10 slots */
         gap: 3px; /* Maintain consistent gap */
    }

     /* Placeholder key styling - visible only in layouts that need it for alignment */
     .key.placeholder {
        background: transparent;
        pointer-events: none;
        border-color: transparent;
        visibility: hidden; /* Hidden by default */
     }

    body[data-keyboard-layout="phonetic"] #keyboard-main-grid .key.placeholder {
        visibility: visible; /* Make placeholder visible in phonetic layout */
        background: rgba(0,0,0,0.03); /* Subtle background */
     }


    .key {
      min-height: 40px;
      /* Adjusted font-size clamp to allow single letters to be larger */
      font-size: clamp(1.2rem, 5vw, 1.8rem);
      font-weight: bold;
      border: 3px solid transparent;
      border-radius: 4px;
      background-color: var(--key-bg);
      color: var(--key-text);
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      touch-action: manipulation;
      text-transform: lowercase;
      padding: 0;
      min-width: 0;
    }
    .key:hover {
        filter: brightness(90%);
    }

    .key.enter,
    .key.delete {
      /* Increased font size for Enter/Delete keys */
      font-size: clamp(0.9rem, 3.5vw, 1.2rem); /* Adjusted clamp values */
      color: white;
      border-width: 3px;
      border-style: solid;
    }
    .key.enter {
        background-color: var(--enter-key-bg);
        border-color: var(--enter-key-bg);
        white-space: nowrap;
    }
    .key.delete {
         background-color: var(--delete-key-bg);
         border-color: var(--delete-key-bg);
         white-space: nowrap;
    }


    .key.correct {
      background-color: var(--correct-bg);
      color: var(--tile-text-dark);
      border-color: transparent;
    }
    .key.present {
      background-color: var(--present-bg);
      color: var(--tile-text-dark);
      border-color: transparent;
    }
    .key.absent {
      background-color: var(--absent-bg);
      color: var(--tile-text-dark);
      border-color: transparent;
    }

    .key.correct.has-present {
        border-width: 3px;
        border-style: solid;
        /* Using a different color for visibility, you might adjust this */
        border-color: #ffff00; /* Example: Yellow border */
    }


    .message-container {
        position: fixed;
        top: 70px; /* Adjust if necessary */
        left: 50%;
        transform: translateX(-50%);
        min-height: 30px;
        z-index: 1000; /* Above popup overlay */
        width: 90%;
        max-width: 350px;
    }
    .message {
      text-align: center;
      font-size: 1em;
      margin-top: 0.5rem;
      padding: 8px 10px;
      font-weight: bold;
      background-color: #333;
      color: white;
      border-radius: 5px;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0s 1.5s, opacity 1.5s linear;
      white-space: normal;
      word-wrap: break-word;
    }
     .message.show {
        visibility: visible;
        opacity: 1;
        transition: opacity 0.3s linear;
     }

    .dark {
        --bg-color: #121213;
        --text-color: #fff;
        --tile-border-empty: #3a3a3c;
        --tile-border-filled: #565758;
        --key-bg: #818384;
        --key-text: #dadce0;
        --tile-text-light: #fff;
        --link-color: #64b5f6;
        --popup-bg: #2c2c2e;
        --popup-text: #eaeaeb;
        --popup-border: #444;
        --popup-overlay-bg: rgba(0, 0, 0, 0.7);
        --popup-close-color: #aaa;
        --popup-link-hover-bg: #3a3a3c;
    }

    .dark .message {
      background-color: #eee;
      color: #121213;
    }
     .dark .key:hover {
         filter: brightness(115%);
     }
     .dark .key.enter:hover, .dark .key.delete:hover {
          filter: brightness(110%);
     }
      .dark .key.correct.has-present:hover {
         filter: brightness(110%);
     }

    .dark .key.correct { background-color: var(--correct-bg); color: var(--tile-text-dark); border-color: transparent;}
    .dark .key.present { background-color: var(--present-bg); color: var(--tile-text-dark); border-color: transparent;}
    .dark .key.absent { background-color: var(--absent-bg); color: var(--tile-text-dark); border-color: transparent;}

    .dark .key.correct.has-present {
        border-color: var(--present-bg); /* Yellow border */
    }


    /* Theme and Layout Button Positioning */
    /* Position these absolutely within the main-content area */
    .main-content > #toggle-theme {
      position: absolute;
      top: 10px; /* Adjusted position slightly */
      right: 10px; /* Position Theme button on the right */
      margin-bottom: 0; /* Remove margin as position is absolute */
      padding: 6px 10px;
      font-size: 0.9rem;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #eee;
      color: #333;
      z-index: 20;
    }
    .dark .main-content > #toggle-theme {
        background-color: #333;
        color: white;
        border-color: #555;
    }

    .main-content > #toggle-layout {
      position: absolute;
      top: 10px; /* Adjusted position slightly */
      left: 10px; /* Position Layout button on the left */
      margin-bottom: 0; /* Remove margin as position is absolute */
      padding: 6px 7px;
      font-size: 0.9rem;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #eee;
      color: #333;
      z-index: 20;
       min-width: 80px; /* Added min-width to prevent text wrap */
       text-align: center; /* Center text in button */
    }
     .dark .main-content > #toggle-layout {
        background-color: #333;
        color: white;
        border-color: #555;
    }

    /* --- Popup Styles --- */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--popup-overlay-bg);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 900; /* Below message container */
        padding: 15px; /* Padding around content */
    }
    .popup-content {
        background-color: var(--popup-bg);
        color: var(--popup-text);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--popup-border);
        max-width: 90%;
        width: 400px; /* Max width for the popup */
        max-height: 80vh; /* Limit height */
        overflow-y: auto; /* Allow scrolling for list */
        position: relative;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .popup-content h2 {
        margin-top: 0;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.3rem;
    }
    .popup-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--popup-close-color);
        cursor: pointer;
        line-height: 1;
    }
    .popup-close:hover {
        color: var(--text-color); /* Use main text color on hover */
    }
    #past-games-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #past-games-list li a {
        display: block;
        padding: 8px 12px;
        margin-bottom: 5px;
        background-color: transparent;
        color: var(--link-color);
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.2s;
        font-size: 0.95rem;
    }
     .dark #past-games-list li a {
        color: var(--link-color); /* Ensure link color is visible */
     }
    #past-games-list li a:hover {
        background-color: var(--popup-link-hover-bg);
        text-decoration: underline;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    .shake { animation: shake 0.6s ease-in-out; }


    /* Media Query for very small/short screens */
    @media (max-width: 340px), (max-height: 600px) {
        .header-container {
            margin-top: 8px;
        }
        h1 {
            font-size: 1.3rem; /* Further reduce */
        }
        #game-number-display {
            font-size: 0.8rem;
        }
        .subtitle {
            margin-bottom: 3px;
        }
         .main-content {
            padding-bottom: 5px; /* Reduce bottom padding for very short screens */
         }
        .board-container {
            margin: 5px 0;
            /* max-width controlled by JS */
        }
        .board, .row {
            grid-gap: 3px; /* Further reduce */
        }
        #keyboard {
            gap: 3px;
            padding: 0 2px;
            margin-top: 3px;
            margin-bottom: 15px; /* Adjusted bottom margin for small screens */
        }
        /* Adjust gaps/columns for smaller screens if needed, though JS might handle size */
         #keyboard-main-grid, #keyboard-top-row {
            gap: 2px; /* Further reduce default gap */
        }
        body[data-keyboard-layout="phonetic"] #keyboard-main-grid {
             grid-template-columns: repeat(10, 1fr); /* Maintain 10 columns */
             gap: 2px; /* Use the smaller gap */
        }


        .key {
            min-height: 36px; /* Further reduce */
            /* Adjusted font size for small screens */
            font-size: clamp(1rem, 3.5vw, 1.3rem); /* Adjusted clamp values */
        }
        .key.enter, .key.delete {
             /* Increased font size for Enter/Delete on small screens */
            font-size: clamp(0.8rem, 3vw, 1.1rem); /* Adjusted clamp values */
        }
        /* Adjust button positions relative to main-content padding/width */
        .main-content > #toggle-theme {
            padding: 4px 7px;
            font-size: 0.8rem;
            top: 2px; /* Adjust based on header changes */
            right: 5px; /* Maintain right position */
        }
        .main-content > #toggle-layout {
            padding: 4px 7px;
            font-size: 0.8rem;
            top: 2px; /* Adjust based on header changes */
            left: 5px; /* Adjust position to the left */
             min-width: 70px; /* Adjust min-width */
        }
        .message-container {
            top: 60px; /* Adjust if needed */
        }
        .popup-content {
            width: 95%; /* Allow popup to use more width */
            padding: 15px;
        }
         .popup-content h2 {
            font-size: 1.2rem;
         }
         #past-games-list li a {
             font-size: 0.9rem;
             padding: 6px 10px;
         }
    }

        /* --- Horizontal Orientation Fix for Mobile (Revised for svh and Board Sizing) --- */
    @media (orientation: landscape) and (max-height: 600px) {
        html { /* Apply svh to html element first */
             height: 100svh; /* Small viewport height - accounts for visible browser UI */
             max-height: 100svh;
             overflow: hidden;
        }
        body {
            height: 100%; /* Takes 100% of html's 100svh */
            max-height: 100%;
            overflow: hidden; /* Prevent overall page scrolling */
            display: flex;
            flex-direction: row;    /* .main-content (left) | #keyboard (right) */
            align-items: stretch;   /* Make columns take full available height of body's content box */
            justify-content: center;/* Center columns if they together are narrower than viewport */
            padding: 3px;           /* Small body padding (3px top/bottom, 3px left/right) */
            gap: 8px;               /* Space between left and right columns */
            box-sizing: border-box; /* Body's padding is INCLUDED in its height/width */
        }

        /* Left Column: Header + Board Area */
        .main-content {
            flex: 1 1 45%;          /* Adjust basis/ratio as needed, aim for board area */
            max-width: 380px;       /* Cap width to prevent board becoming excessively wide */
            height: 100%;           /* Stretches to body's content-box height */
            display: flex;
            flex-direction: column; /* Stack header then board-container vertically */
            align-items: center;    /* Center children horizontally */
            justify-content: flex-start; /* Align children (header, board) to the top of this column */
            padding: 0;
            margin: 0;
            overflow: hidden;       /* No scroll for this entire column */
            box-sizing: border-box;
        }

        .main-content > .header-container {
            flex-shrink: 0;
            width: 100%;
            margin-top: 0;
            margin-bottom: clamp(1px, 0.1svh, 1px); /* Minimal bottom margin, svh based */
        }
        .main-content > .header-container h1 {
            font-size: clamp(1rem, 2.8svh, 1.3rem); /* Responsive title with svh */
            margin: 0;
        }
        .main-content > .header-container #game-number-display {
            font-size: clamp(0.7rem, 2svh, 0.9rem); /* svh based */
        }

        .main-content > .subtitle {
            flex-shrink: 0;
            width: 100%;
            font-size: clamp(0.65rem, 1.8svh, 0.8rem); /* svh based */
            margin-top: 0;
            margin-bottom: clamp(1px, 0.2svh, 2px); /* Minimal, svh based */
        }
        
        .main-content > #toggle-theme {
            top: clamp(2px, 0.5svh, 4px); 
            right: clamp(2px, 0.5svh, 4px);
            padding: clamp(2px, 0.6svh, 4px) clamp(3px, 0.8svh, 6px); 
            font-size: clamp(0.7rem, 1.8svh, 0.9rem); /* svh based */
        }
        .main-content > #toggle-layout {
            top: clamp(2px, 0.5svh, 4px); 
            left: clamp(2px, 0.5svh, 4px);
            padding: clamp(2px, 0.6svh, 4px) clamp(3px, 0.8svh, 6px);
            font-size: clamp(0.7rem, 1.8svh, 0.9rem); /* svh based */
        }

        .board-container {
            flex-grow: 1;           /* Take remaining vertical space in .main-content */
            width: 100%;
            max-width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: clamp(1px, 0.2svh, 2px) 0 0 0; /* Minimal top margin, svh based */
            min-height: 0;          /* Crucial for flex-grow to allow shrinking */
            overflow: hidden;       /* No scrollbars within board-container */
        }

        .board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            grid-gap: clamp(2px, 0.4svh, 3px);  /* Responsive gap based on svh */
            height: 100%; /* Fill the allocated height from .board-container */
            width: auto;  /* Width will be determined by height and aspect-ratio */
            aspect-ratio: 5 / 6.1; /* Adjust if tiles aren't perfectly square after svh fix */
            max-width: 100%;
        }
        
        .tile {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-width: 1px;
            font-size: clamp(0.8rem, 2.8svh, 1.6rem); /* Responsive font relative to svh */
            display: flex; align-items: center; justify-content: center;
        }
        .tile > div { 
            line-height: 1;
        }

        /* Right Column: Keyboard */
        #keyboard {
            flex: 1 1 50%;
            max-width: 480px;
            height: auto;
            align-self: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 2px;
            margin: 0;
            gap: clamp(2px, 0.4svh, 3px); /* svh based */
            box-sizing: border-box;
        }
        
        .key {
            min-height: clamp(28px, 4.8svh, 38px); /* Keys scale with svh */
            font-size: clamp(0.7rem, 2.3svh, 1.2rem); /* svh based */
            border-radius: 3px;
        }
        .key.enter, .key.delete {
             font-size: clamp(0.6rem, 1.9svh, 1rem); /* svh based */
        }

        .message-container {
            top: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: auto; 
            min-width: 140px;
            max-width: 280px;
            padding: 3px 5px;
            z-index: 1000;
        }
        .message {
            font-size: clamp(0.7rem, 1.7svh, 0.9rem); /* svh based */
            padding: clamp(4px, 0.8svh, 6px) clamp(6px, 1svh, 8px); /* svh based */
            margin-top: 0;
        }
    }

  </style>
</head>
<body>
  <div class="main-content">
      <!-- Header Container -->
      <div class="header-container">
         <h1>Wordle <img src="flag.png" alt="๐ฆ๐ฒ" style="height: 0.7em; vertical-align: middle;"></h1>
         <!-- Game Number Display -->
         <span id="game-number-display">ิฝีกีฒ #...</span>
      </div>
      <!-- Subtitle -->
      <p class="subtitle">by <a href="https://www.armblog.net" target="_blank">Armen Mkrtchyan</a></p>

      <!-- Controls -->
      <button id="toggle-theme">๐</button>
      <button id="toggle-layout"></button>

      <!-- Message Container -->
      <div class="message-container">
         <div id="message" class="message"></div>
      </div>

      <!-- Board -->
      <div class="board-container">
         <div class="board" id="board"></div>
      </div>
  </div>

  <!-- Keyboard -->
  <div id="keyboard">
      <div id="keyboard-top-row"></div>
      <div id="keyboard-main-grid"></div>
  </div>

  <!-- Past Games Popup -->
  <div id="past-games-popup" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <span class="popup-close" id="popup-close-button">ร</span>
      <h2>ีีกีญีธึีค ีญีกีฒีฅึีจ</h2>
      <ul id="past-games-list">
        <!-- Dynamically populated -->
      </ul>
    </div>
  </div>


<script>
  const boardElement = document.getElementById('board');
  const keyboardTopRowElement = document.getElementById('keyboard-top-row');
  const keyboardMainGridElement = document.getElementById('keyboard-main-grid');
  const keyboardElement = document.getElementById('keyboard');
  const toggleBtnTheme = document.getElementById('toggle-theme');
  const toggleBtnLayout = document.getElementById('toggle-layout');
  const messageElement = document.getElementById('message');
  const mainContent = document.querySelector('.main-content');
  const gameNumberDisplay = document.getElementById('game-number-display');
  const pastGamesPopup = document.getElementById('past-games-popup');
  const pastGamesList = document.getElementById('past-games-list');
  const popupCloseButton = document.getElementById('popup-close-button');

  // --- Constants ---
  const WORD_LENGTH = 5;
  const MAX_ROWS = 6;
  const ENTER_KEY = 'ีจีถีคีธึีถีฅีฌ';
  const DELETE_KEY = 'ีปีถีปีฅีฌ';
  const LOCAL_STORAGE_LAYOUT_KEY = 'armenianWordleLayout';
  const LOCAL_STORAGE_HISTORY_KEY = 'armenianWordleHistory';
  const START_DATE_STRING = "2025-05-02"; // This date is in Armenian local time

  // --- Timezone Constants ---
  const ARMENIA_TIMEZONE_OFFSET_HOURS = 4; // AMT is UTC+4
  const ARMENIA_TIMEZONE_OFFSET_MS = ARMENIA_TIMEZONE_OFFSET_HOURS * 60 * 60 * 1000;

  // --- Word List (remains the same) ---
  const WORDS = ['ีกีพีตีธึีถ','ีกึีชีฅึ','ีฏีกึีกีฃ','ีฏีกีฒีถีซ','ีฎีกีฃีธึีด','ีญีฅีฌีธึ','ีฟีกีถีซึ','ีถีกีดีธึีฝ','ีถีกีดีกีฆ!','ีกีถีฃีซึ','ีคีกีฃีกีฒ','ีฝีธึีฌีธึ','ีกีฏีธึีค','ีฎีกีดีฅีฌ','ีฐีกีดีกึ!','ีฏีผีถีกีฟ!','ีขีกึีฑึ','ีธีฟีถีกีฏ','ึีฉึีกีถ','ีฉีกีฏีธึ!','ีทีซีฟีกีฏ!','ีฝีฟีฅึีป','ีฒีกีฆีกีญ!','ีพีฅึีซีถ','ีธึีถีฅีฌีซ','ีฆีถีถีฅีฌ','ีฐีกีถีธึีด!','ีฏีกีฟีกึ','ีฎีซีฎีกีฒ','ีฎีกีฎีธึีฏ','ีฆีธีคีธึีด','ีฃีธึีถีกีฟ!','ีคึีกีดีก!','ีบีถีคีธึีฏ!','ีกีถีฟีฅึ!','ีฎีกีพีกีฌ','ีธีฌีธึีฟ','ีฆีฃีกีฝีฟ','ีปีธึีฉีกีฏ','ึีกึีกึ','ีฐีถีธีฟีซ!','ีฏึีฎีธีฒ','ีฟีกีทีฅีฌ','ีบีกึีกีบ!','ีขีผีถีกีฏ','ีกีพีฌีฅีฌ!','ีถีฆีธีพึ','ีฐีกีฟีธึีด!','ึีกีฃีธีฟ','ีฏีกีฉีฝีก','ีฝีฉึีฅีฝ!','ีฐีกีฟีธึ','ีทีผีกีตีฌ!','ีขีกึีซีฌ','ึีฎีถีธีฒ','ีดีกีฟีกีฒ','ีฎีกีดีธีถ','ีถีบีกีฝีฟ','ีณีกีฐีซีณ','ีฏีฅีถีกึ','ีฝีกีดีขีก!','ีฝีฟีพีฅึ','ึีซีดีซีก','ึีถีถีฅีฌ','ีถีธึีฅีฏ!','ีฏีกีฉีธีค!','ีทึีพีฅีฌ!','ีฝีกีฝีกีถ!','ีทีถีธึีฐ','ีปีถีปีฅีฌ','ีถีฅึีฏีก!','ีฏีดีกีญึ','ึึีฏีฅีฌ','ีฝีกีบีกีฟ','ีกีถีดีกีฐ!','ีฐีฅีฎีกีถ!','ีนึีฌีกีญ!','ีกีฃีผีกีพ','ีกึีตีธึีถ','ีญีธีทีธึ','ึีกึีธึีฏ','ีญีธึีณีกีบ','ีฏึีบีกีฏ','ีกีถึีธึีด','ีฏีกีฉีซีฌ','ีกีบึีฅีฌ','ีฟีพีตีกีฌ','ีฟีกึีกีฆ','ึีกีถีกีฏ','ีฌีกีฏีธีฟ!','ีชีญีฟีฅีฌ','ีดีธีญีซึ','ีนีกีดีซีน','ึีดีฅีฃีก','ีขีฏีฌีซีฏ!','ีฟีธีถีฅีฌ','ีถีซีฐีกึ','ีฏีกีญีฅีฌ','ีถีฅีฒีธึึ','ีธีฝีฏีตีก!','ีฟีฅีฝีธึีน','ีดีซีปีกีฟ','ีดีธึีดีซีก!','ีกึีฝีธึ','ีกึีคีธึีฏ','ีคีกีปีฅีฌ!','ีฃีธีดีฅีท','ีณีฆีดีฅีฌ','ีฎีถีฎีฒีก','ึีซีฌีฟึ','ีฝีกีผีกีฎ!','ีญึีฉีซีถ','ีฅีฌึีงีป','ีกึีฏีกีฎ','ีขีฅีฒีฌีธึ!','ีขึีคีฅีฌ!','ีถีฅึีฅีฌ','ึึึีซีป','ีฌีกึีฅีฌ','ีฏีธีนีธึีด','ีฎีถีพีฅีฌ','ีฎีกึีซึ','ีฃีธีฐีกึ!','ีญีถีกีดีซ','ีถีกีญีซึ','ีถีถีปีฅีฌ','ีฐึีทีฅีป','ีฅึีฃีซีน','ีฝีบีธึีฟ','ีฎีฅีฎีฅีฌ','ีธึีผีฅีถีซ','ีฆีธึีฅีฒ!','ีดีธึีฉีซ!','ีพีณีผีฅีฌ','ีฏีฟึีฅีฌ','ีฐีกึีกีพ','ีฎีธึีกีฏ','ีดีกึีธึึ','ีกึีปีธึีฏ!','ีฟีกีปีซีฏ','ีฝีธึีฟีกีฏ','ึึีฏีซีน','ีณีฏีธึีตีฉ','ีงีฏึีกีถ','ีคีซีดีธึีด','ีฎีธึีฒีกีฏ','ีฉีดีขีธึีฏ','ีกึีฃีธีถ!','ีฝีฏีซีฆีข','ีฏีฅีฝึึ','ีกีฝีธึีตีฉ','ีฌึีพีกีฎ!','ีฃีกีฆีกึ','ีฆีถีถีธีฒ!','ีฝีซึีธีฒ!','ีบีกีฝีซีพ!','ีฆีฒีปีธึีด','ึีกึีธีฝ','ีนีฒีปีซีฏ','ีฉีผีนีธึีถ','ีฟีกึีกึ','ีขีธึีธีฟ!','ีฐีถีกึึ','ีทีกึีกึ','ีทีกีฒีกึ','ีฏีกึีซีณ','ีดีธีฟีซีฏ!','ีญีกีถีธึีฉ','ีฝีซีขีฅีญ!','ีถีฝีฟีฅีฌ','ีบีฒีฟีธึ!','ีขีกีถีธึีฏ','ีนึีถีกีฒ!','ีกีฏีธึีถึ','ีฐีกีฝึีฅ','ีคีธีถีธึ','ึีทึีฅีฌ','ีดึึีธึีด!','ีกีฒึีกีฟ','ึีกีถีธีถ','ีถีธีญีกีฆ!','ีฌึีฟีฅีฝ','ีบีกีฟีกีผ','ีฝีซึีกีฎ!','ีกีถีฃีฅีฟ!','ีกีฒีธีฉึ','ีดีฏีถีซีฏ!','ีฝีธีฒีธึีถ','ีฏีซีฉีกีผ!','ีฏีกีตีฝึ','ีคีซีฟีฅีฌ','ีฉีผีนีฅีฌ','ีดีกีผีกีถ','ีฝีถีธีฟีซ','ีฟีกึีซึ','ีดีซีปีซีถ!','ีดีกีฎีธึีถ','ีฟีกึีกีฏ','ีฅึีฅีฏีธ','ีกีณีตีธึีถ','ีฟีฅึีฝีฟ','ีฐึีฉีซีผ','ีคีกีถีกีฏ','ีฌีพีกึึ','ีฏีธีดีซีฏ!','ีกีถีฆีฅีถ!','ีขีตีธึีปีฅ','ีฟีธีฏีธึีถ','ีดีฅีคีกีฌ!','ีฝีฏีฝีฅีฌ','ีขีผีถีซีน','ีดีฅีฟีกีฒ','ึีฝีดีกีถ','ีฌีกีบีทีก','ีดีซีฟีธึีด','ีขีกึีกีฏ','ีกึีฎีซีพ','ึีกีตีฟีฅ','ีฏีบีนีฅีฌ','ีฐีบีกึีฟ','ีขีกีชีซีถ','ีนีดีธึีทีฏ','ีคีกีตีกีฏ','ีกีดีกีตีซ!','ีขีธีชีธีช','ีญีถีคีซึ','ีฏีซีฟีฅีฌ!','ีฏีธีฟีฅีด!','ีจีดีขีซีท','ีฐีถีกีธีณ','ีถีผีถีกีฏ','ึีกีขีขีซ','ีกีฟีตีกีถ','ีทีกีพีซีฒ','ีกีฒีพีฅีฝ','ีฉีดีขีซึ','ีฅีผีกีถีค','ีฐีกีฌีธึ!','ีดึีฝีฅีฌ','ีนีซีถีกึ!','ีญีถีกีดึ','ีธีฝีฟีกีถ!','ีฉึีฉีธึึ','ีกีผีพีกีฏ!','ีฑีกีพีกึ','ีบีธีนีกีฟ!','ีฌีธีฒีกีฏ','ีจีถีฟีซึ','ีฅึีฏีกึ!','ีกีตีฝึึ','ีทึีปีฅีฌ','ีกีถีธีถีฝ!','ีฃึีบีกีถ','ีพีซีบีกีฏ','ีบีกีฐีฅีฌ','ีชีธีฒีธีพ','ีฏีกีบีซีน!','ีถีชีธึีตีฃ','ีขีถีกีฆีค','ีนีฅีฆีธึ','ีฏีฌีซีดีก','ีคีชีฃีธีฐ','ีฝีถีธึีถีค','ีกีฎีกีถึ!','ีฏีกีบีกึ','ีฐีกีฝีกีฎ!','ีฅีฌีธึีตีฉ','ึีฅึีดีก','ึีธึีฅีฌ','ีฏีซีฝีกีฟ!','ีฃีถีคีกีฏ','ีฅีฆีฅึึ!','ีคีฅีฒีซีถ','ีฝึีขีกีถ','ีกีดีขีธีญ','ีฅึีกีถีฃ','ีญีกีทีฅีฌ!','ีฉึีดีฅีฌ!','ีขีทีฟีซีฏ','ีกึีฎีกีฉ','ีฉีทีทีกีฌ!','ีกีขีฅีฒีก','ีกีบึีซีฌ','ีฝีซึีธึีถ','ีฐีกีฝีกีฏ','ีฌึีกีฟีธึ','ึึึีกีถ','ีฟีซีฏีซีถ','ีณีซึีกีถ','ีฏีธีบีซีฟ','ึีธึีผีกีฏ','ีฅึีฏีกีฉ','ึีกีทีฅีฌ','ีกีถีฐีกีด!','ีดีกีฌีธึีญ','ีกีถีขีซีฎ!','ีดึึีฅีฌ!','ีขีฅึึีซ','ีกีบีฟีกีฏ','ีฏีฅีผีกีฝ','ึีธีฒีธึีถ','ีฐีกีฟีธึีฏ!','ีฌีธึีฟีธึ!','ึีถีธึึ','ีกีผีถีฅีฟ','ึีกีพีธีฟ','ีกีดึีธึ','ีกึีณีซีณ','ีซีถีฅึีฟ!','ีฏีกึีซีถ','ีฝีธีฒีกีฌ','ีฐีกีดีฅีฒ','ีบีฒีบีฅีฒ','ีฏีธีทีซีฏ','ีกีถีคีฅีด!','ีฟีกีฏีกีผ','ีณีถีทีธึีด','ีฌีธีฒีกีฌ','ีฏึีฏีฅีฝ','ีฃีถีคีซีฏ!','ีฐีตีธึีฝีถ','ีถีกีญีถีซ','ีทีฅึีธึ','ีฅึีฅีญีก','ึีกีฉีซีฌ','ีดีฅีฟึีธ','ีทีธึีทีกีถ','ีบีฒีซีถีฑ','ีพีซีฝีฏีซ','ีฐีฝีฟีกีฏ','ีกึีฒีกีถ!','ีบีกึีฃึ','ีฏีซีฝีฅีฌ','ีบีกีฃีฅีฌ!','ีฅีฒีฅีฃีถ','ึีญึีธึีถ','ีฟีกึีฅึ','ีนีธีขีกีถ!','ึีฅึีฅีฌ','ีทึีปีกีถ','ีพีฅีฆีซึ','ีฏึีธึีถีฏ','ีณีกีฏีกีฟ','ีบีกึีกีถ','ีคีกีฐีซีณ','ีขีกึีกีฟ','ีกีฏีธึีดีข','ีฐีธีพีกีฆ','ีกีฝีธึีซ!','ีขีซีขีกึ!','ีฉีกึีฅีฌ!','ีถีธีฟีกึ!','ีคีธีฃีดีก!','ีกึึีธีฟ!','ีกีฌีตีธึึ','ีขีกีฆีธึีฏ','ีฟีกีทีฅีฒ','ีฟีฅีฝีซีฌ','ีฏีฟึีธึีฏ!','ีธีฒีธึีฏ','ีฅีฒีฅีผีถ!','ีฌีธึีฎีธึีด','ีขีกีถีกีฏ','ีกีดีขีกึ','ีฝีกีถีซีฏ!','ีผีฅีฟีซีถ','ีบีถีคีฅีฌ','ีดีฅีคีซีก!','ีฎีซึีกีถ','ีฏีตีกีถึ','ีขีธีขีซีฏ!','ีถีฅีญีฅีฌ','ีฐีธึีชีฏีธึ!','ีฐีธีฃีธึ!','ีกึีทีกีพ','ีฃีฅีฟีกีฏ!','ีคีชีพีกึ','ีถีพีกีฝีฟ!','ีบีฅีบีฅีถ!','ีขีฅีฏีธึ','ีฐีซีดีกึ','ีฌีธึึีฏีซ','ีฉีธีถีซึ','ีดีธีคีฅีด!','ีญีฒีณีกีฌ','ีกีฒีดีธึีฏ','ีฟีกีพีกึ','ีฏีกีธึึีซ!','ีฟีถีปึีซ','ีฝีฟีฅีฒีถ','ีฃีฅีฟีซีถ','ีฝีกีพีกีถ','ีกีฟีฌีกีฝ!','ีฑีฃีฟีฅีฌ','ีฐีกีฆีกีฌ!','ีญีซีฆีกีญ','ึึึีธึึ','ีดีฟีถีฅีฌ!','ีปีธีฏีกีฟ','ีฆึีธึีตึ','ีญึีธีญีฟ!','ึีกีดีฅีฌ','ีขึีคีตีก!','ีกีฒีกีถีฑ','ีดีซีปีธึีฏ','ีกึีดีกีฟ','ีกีฏีถีธึ','ีฏีฅึีซึ!','ีดีซีถีนึ!','ีดีกึีฅีฌ!','ีฐีธึีทีธึีด','ีญีกีฒีกีฌ','ีนีกึีฅีฌ','ีขึีคีธีฟ!','ีญีญีธึีถีป','ีฏีถีธึีถึ','ีฏีกีทีพีฅ!','ีดีซีปีธึ','ีถีฅึีธึีช','ีฏีกีถีกีน','ีกึีฑีกีถ','ึึีฃีกีถ','ีกีฒีตีธึีฝ','ีฏีกึีกีฟ!','ีคีกีชีกีถ','ีฃีฆึีธึ!','ึีธึีนีซีฏ','ีฝีธีพีกีฎ','ีฎีซีฎีกีฏ','ึีกีฏีกีถ','ีดีกีฟีซีฟ','ีฉีฅึีธึีฏ','ีฉีซีฉีฅีผ','ีฃีธึีดีกึ','ีฅึึีกีฏ!','ีดีฅีฉีธีค','ึีฎีถีฅีฌ','ีฟีกีพีซีฒ','ีฎีธีพีกึ','ีขีกึีคีซ','ีซีดีกีฝีฟ','ึีฝีญีฅีฌ','ีกีบีกีฃีก','ีฐีธีพีซีพ','ีผีธึีขีฌีซ!','ีญีกีพีซีฎ','ีบีกึีฟึ','ีธีฐีดีกีฏ','ีคีกีฏีซีน!','ีฑีกีฃีกึ','ีนีกึีซึ','ีฏีถีณีซีฉ','ีดีกีฝีธีถ!','ีฑีฃีพีฅีฌ!','ีฐีกีดีธีพ!','ีนีถีนีซีถ!','ีพีกีฐีกีถ','ีธีนีซีถีน!','ีดีกึีซีก!','ีพีฆีถีธึ','ีฝึีณีฅีฌ','ีฝีธีญีธึีฏ','ีกีฏึีซีฆ!','ีฌีฅีดีธึึ!','ีขีกึีฅีฌ','ีปึีฐีธีฝ','ีบีถีคีธึีด!','ีขีกึีธึีด','ีฉีผีซีนึ','ีผีกีขีซีฆ!','ีฏีฝีฏีซีฎ','ีคีกึีถีซ','ีขีซึีชีก!','ีขีซีฆีธีถ','ึีธึึีกีฏ','ีกึีคีกึ','ีดีกีฃีซีฌ','ีถีตีกึีค','ีธีผีถีกีฌ!','ีฐีฅีฟีซีถ!','ีคึีธีทีด','ีฝีดีขีธึีฏ!','ีดีฅีผีกีฎ!','ีดีธีฌีธึ!','ีญีผีบีธีฟ!','ีคีฒีตีกีฏ','ีกีฏีกีถีป','ีฐีกีดีฅีด','ีฅึีคีธึีด','ีณีธึีผีกีฏ','ีผีฅีฃีขีซ!','ีดีกีดีธึีฌ','ีฝีบีซึีฟ','ีฉีกึีกีญ','ีฏีผีผีกีฌ!','ีคึีกีญีฟ','ึีกีฏีฅีฌ','ีญีดีขีกีฏ','ีดีกีฆีธีฟ!','ีบีฟีธึีตีฟ','ีกีถีฏีธึีด','ีฏีธีณีกีฏ','ีดีกีถีธึีฏ','ีกีถีขีกีถ!','ีฐีกีณีกึ!','ีฅึีคีซีฏ','ีธีนีญีกึ','ีฏีกีตีธึีถ!','ีฐีกีฟีกีฏ','ีฌึีตีกีฌ!','ีฐีดีกีตึ','ีดีกีถึีง','ีขีธีฒีธึ','ีขีดีขีธึีฌ!','ีฏีทีฅีผึ','ีฟีธีถีถีก','ีฏีธีกีฌีก','ีฌีธีฌีซีฏ','ีกีถีฐีธีฃ!','ีฏีกีตีกีถ','ีพีกีผีธีค','ีกีถีธึึีป','ีธึีฝีกีฌ','ีฏีกีดีกึ','ีฅึีซีถีป','ีฉีฆีฅีถีซ','ีฉีกีฉีกึ!','ีฌีธีขีขีซ!','ีคีกีคีกึ','ีถีฅีญีธึึ','ีฃีกีฃีกีฉ','ีบีกึีฅีฌ','ีพีกึีกีฏ','ีคีซีฅีฟีก!','ีฝึีณีฅึ','ีกีผีตีธึีฎ','ีณีธีบีกีถ','ีฉีกีผีกึ!','ีฝีฏีตีธึีผ','ีฏีกีดีกึ!','ีฝีฅึีซีก!','ีพีกึีฅีฌ','ีปีซีฐีกีค!','ีบีกึีฅีฏ','ีณีกีฒีกีฟ','ีกึีฑีกีฏ','ีญีฒีณีธึีฏ','ึีถีถีซีน','ีญีธึีณีธึีณ','ีญึีณีซีฉ','ีฌีตีกึีค','ีนีฅีนีฅีถ','ีคีกีฐีธึีฏ','ีฝีซีฝีฅีผ!','ีฏีผีพีฅีฌ!','ึีฉีตีกีฏ','ีถีกึีคีซ!','ีฐีถีคีซีฏ','ีณีกีฃีกึ','ีนีกีดีกีถ!','ึีกีพีฅีฌ','ีฐีธีฝีฅีฌ','ีฏึีธึีค','ีพีกีฝีกีฌ','ีทีกีขีกีฉ','ีดีซีกีตีถ!','ีฐีกีฆีกึ','ีฆีฃีธึีตีท!','ีบีกีฟีซีช','ีกีฒีกีถีค','ีฉีธึีฉีกีฏ','ีฝีกีดีซีฉ!','ีฝีกีดีขีธ!','ีฆีพีกึีฉ','ีกีถีญีถีก!','ีขีชีซีทีฏ','ีฐีธีฃีถีก!','ีขีกึีซีน','ีดีฆีฏีซีฉ','ึีถึีธึีท','ีฌีกึีธีฒ!','ีจีถีฏีฅึ','ีฏีกึีกีบ','ีฃีกีพีกีฉ','ีทีฌีคีซีฏ','ีฏีธีฒีธีพ','ีฐีผีนีกีฏ','ึีฃีถีฅีฌ','ึึีฝีซีค','ีฌีกีฆีฅึ!','ีฐีกีทีซีพ','ีฏีกึีฅีฌ','ีฟีกีถีฃีธ','ีคึีพีกีฃ','ึีธีฟีธีถ','ีกีถีดีซีฟ!','ีฟีถีฟีฅีฝ','ีญีธึีฅีฌ','ีฎีธึีกีฌ!','ีกีณีธึึีค','ีกีฆีคีฅีฌ!','ีฏีณีฒีกีฏ!','ีฅึีฃีฅีฌ','ีฐีธีฏีฅีต!','ีพีกีถีธีฒ','ีฝึีธึีถึ','ีพีฆีฏีกีบ','ีบีซีฟีกีฏ','ีขึีซีถีฑ','ีกีฒีฅึีฝ!','ีฐีกึีซีน','ีกึีฌีธึ','ีดีซีฆีฅีฌ!','ีฝีฟีพีกึ','ีฌีธีฒีกึ','ีฃีดีขีฅีฉ','ีกีถีฆีธึ!','ีฝึีซีถีฃ','ีณีกีทีกีฏ','ีกีผีถีฅีฌ!','ีขีฌีฉีกีฏ','ีปีถีปีธึ','ึีกีดีซีน','ีฃีกึีธึีถ','ีบีกีทีกึ','ีญีฌีธึึีค','ีคีธึีฝีฟึ','ีปีฅีผีธึ','ีฟีซีบีซีฏ','ีซีฝีฌีกีด','ีฆีฃีฅีฝีฟ','ีฏีกีฏีกีธ!','ีฎีกีฒีซีฏ','ีกีถีฟีซีฏ!','ีคีคีดีซีฏ','ีฉีกีถีกึ','ีทีฅึีฅึ','ีฉีพีกีถึ!','ีถีซีฆีกีฏ','ีฃีฅึีกีณ','ีคีฅีฏีกีถ!','ีนีธึีธึ!','ีคีธีฌีกึ!','ีฃีฅึีกีถ','ีฏีผีธึีถีฏ','ีทีถีนีฅีฒ!','ีฏีธึีฅีฏ!','ึีฅึีฅีฏ','ีธึีฆีขีฅีฏ!','ีกีถีฏีกีบ!','ีฌีกึีธึีด','ีถีกีพีกีฏ','ีฟีธีถีธึีฝ','ีฅีฒีธึีถีฃ','ีฉีกีถีฑึ','ีฃีกีฌีซึ!','ีฅีฒีตีกีด','ีกีถีฉีซีพ!','ีฐีกีทีซีท!','ีฌีซีฆีฅีฌ!','ีฏีฟึีธีถ','ีฏีธีขึีก!','ีฅีผีกีฏีซ!','ีญีกีผีกีฟ','ีกีถีคีกีด','ีฎีกีฌีฅีฌ!','ีขีกีชีกีฏ','ีปึีพีฅีช','ีถีธึีซึ!','ีฝีบีธึีถีฃ','ีพีธีฏีกีฌ','ีฐีฝีฏีซีน','ีบีกีฐีกีฏ','ีฟีฏีฌีธึ','ีฆีธีคีฅีฌ','ีกีตึีธึ!','ีฝีฅีฒีกีถ','ีฏีธึีฆีซีฏ!','ีฟีซีฟีกีถ','ีธีฝีฟึีฅ','ีฝีฟีธึีตีฃ','ีฐีกีฟีซีฏ','ีธีฒีขีกีฌ!','ึีกีดีธึ','ีกึีญีซีพ','ีฝีฅีถีกีฟ!','ีคีซีดีกีฏ','ีขีธึีชีซีน!','ีฉีธีทีกีฏ','ีฟีฅีฝีกีฏ','ึีฌีธึีถีฃ','ีฝีฅีฌีกีพ!','ีฃีฟีถีฅีฌ','ีกีฆีถีซีพ','ีฏีกีญีซีน!','ีฝีดีขีกีฏ','ีถีซีฏีฅีฌ!','ีคีกีฟีฅีฌ','ีกีผีธึีตีฃ!','ีฝีกึีธึ','ีกีปีฌีซีฏ!','ีบีกึีฅีถ','ีพีกีฒีธึึ','ีธึีฒึีธึ','ีดีกีถีฃีธ','ีญีธึีกีถ','ีกีฎีฅีฌีซ','ึีฅีฟีธึึ','ีบีธึึีกีฏ','ึีธีญีฅีฌ','ีฝีซึีฅีฌ','ีพีกีตึีซ','ีฟีกีณีกึ','ีคีซีบีธึีฏ','ีจีดีบีฅีฌ','ีฅึีกีทีฟ','ีฏีกีพีซีณ','ีธึีฟีฅีฝีฟ','ีดีธึีธึึ','ีกีดึีธึ!','ึีธีฌีฅีป','ีฅีผีตีกีฏ','ีญีธีฝีฅีฌ','ีดีกีตีซีฝ','ีฃีซีทีฅึ','ีณีกึีฅีฌ!','ีกึีดีกีพ','ีฎีฎีธึีดีข','ีกีฒึีกีถ','ีบีกีฏีกีฝ!','ีขีธึีชีธึีด','ีกีขีญีกีฆ!','ีฟีกีผีฅีญ','ีฐีกีพีกีถ!','ีพีกีฃีธีถ','ีขีธึีฝีก!','ีฆีกีพีกีฏ','ีกีฏีฟีซีพ','ีฝีกีฌีธึ','ีฅึีทีซีฏ','ีฉีฅึีกีณ','ีฅึีฏีซึ','ีฉีธีพีซีน!','ีขีผีถีฅีฌ','ีฝึีพีกีฏ','ีฏึีฏีซีถ!','ีคีชีธีญึ','ีฆีซีปีธีฒ!','ีฝีญีฅีดีก!','ีฝีธีญีกีฏ','ีฃีซีฟีกีฏ','ีฏีกีฟีกีฏ','ีซีทีญีกีถ','ีดีฅีผีฅีฌ!','ีทีกีบีซีฏ','ีฝีฟึีธึีฏ','ีฏีกึีกีพ','ีฎีกีถีธีฉ','ีฏีกึีธีฟ','ีพีกีผีฅีฌ','ีฉึีปีฅีฌ','ีบีซึึีก!','ีฃีถีกึึ','ีพีกีผีซีน','ีฟีกีบีกีฏ','ีญีธีถีกีพ!','ีทีซีถีฅีฌ!','ีงีฉีซีฏีก!','ีกีถีฏีกีญ!','ีขีธีฝีธึ','ีกีฌึีธึ','ีกีผีธีฒีป','ีฃีกีณีกีณ','ีฏึีฎีฅีฌ','ีบีกีถีซึ','ีฌีกีพีกีท','ีกีดีธึึีซ!','ึีถึีธึีด','ีฝึีขีซีน','ีธึีฒีฅึีฑ','ีทีซึีซีด','ีฐีฅีฒีธึีฏ','ีฏีธึีกีฎ!','ึีกีดีกึ','ีกีฒีปีซีฏ','ึีซีฆีซีฏ','ีธึีฌีธึีถึ','ีชีตีธึึีซ','ีฃีฟีกีฎีธ','ีฏีกีถีธีถ','ีกีพีกึีฟ','ึีซีดีซีฏ','ีพึีฑีซีถ','ีถีกีดีกีฏ','ีดีฉีฅึึ','ีคีฅีฌีฟีก!','ีฌีธึีฝีซีถ','ีฐีฅีฒีฅีฒ','ีขีถีธึีตีฉ','ีคีถีนีซีฏ!','ีกีถีฑีกีพ!','ีดีฅีถีกีฏ!','ีพีซีณีกีฏ','ีฏีกีบีซีฏ','ีฉีซึีกีญ','ีฉีกึีธึีถ','ีฐีธึีฆีซีน!','ึีธึีฅีถ','ึีบีฅึีก','ีฟีกีขีกีฟ','ีฆีกีฟีซีฏ','ีฉีกีญีซีฎ','ีดีฏึีกีฟ','ีขีธีฌีธึีฏ','ีขีกีญีธึีด','ีฝีธึีฌีซีน','ีฐีธีบีธีบ','ีฏีธีฟีธีท!','ึีธีฉีธีฉ','ีฏีถึีฅีฌ','ีฝีฅีฆีธีถ!','ีนีกึีนีซ!','ีฏีกีถีฅึ','ีกีพีกีถีค','ีผีฅีฆีธึีฝ!','ีดีฅีฌีซึ!','ีณีกีดึีก!','ีฉีฌึีกีฟ!','ีกีถีกีดีบ!','ีกีถีฅีฎึ','ีฐีกีพีกีฟ','ีฐีกีฌีพีก!','ีฐึีคีฅีฐ','ีฝีถีกีถีฏ','ีถีกีตีฅีฌ!','ีฎีธึีกีถ!','ีฟีกีฟีซีฏ','ีฏีกึีธีฒ!','ีฉีผีนีธีฒ!','ีทึีฅึีฉ','ีฌีธึีฝีกีถ','ึีคีกีนีธึ','ีกีบีกีฏีซ','ีฆีธึีผีถีก!','ีบีกีฟีซีพ','ีพีซีทีกีบ','ีฏีธีฏีซีฏ!','ีญีดีซีนึ','ีบีธีบีธึ!','ีดีธึีฅีญ!','ึีถึีธึีฒ','ีชีกีถีซึ','ีฉีกีฌีกีถ','ีฉีทีพีกีผ','ึีกีฒีกึ','ีฝีกีฌีซีฏ','ีญีฝีฟีซีพ!','ีกีถีณีกึ!','ีบีกีฐีธึ','ึีธีนีฅีฌ','ึีกึีธีฆ','ีฟีกึีฝีซ','ีญีณีธึีฒีซ','ีญีธีผีธีน','ีฉีกึีธึ','ีฏีธึึีฎึ','ีคีธีคีธีท!','ึีกีฆีซีฝ','ีฃีธีผีธoz','ีธึึีขีกีฉ','ีกีตึีฅีฌ','ีฐีถีนีฅีฒ','ีฝึีผีฅีฌ','ีฃีกีฌีกึ','ีฏีฟึีซีณ','ีฅีฌีถีฅีฌ!','ีฑีตีธึีคีธ','ีผีฅีฐีกีถ','ีฉีฉีพีกีท','ีทีถีนีฅีฌ','ีฐีกีฟีฅีฌ','ีญีธีชีธีผ!','ีฏึีณีกีฟ!','ีฏีธีนีฅีฌ!','ีฏีกึีซึ','ีฃีถีธึีค','ีกีถีฏีธีน!','ีฉีกีพีซีท','ีญีกีพีกึ','ีฟีซีบีกึ','ีฅีฒีซีถีป','ึีธีฉีธึีฏ','ีฟีกีบีกีถ','ีญีกีฒีธีฒ','ีถีทีฟีกึ!','ีดีกีฟีธึีผ','ีฎีกีฏีธีฒ!','ีฐีฅึีธีฝ','ีบีกีผีกีพ!','ีกีถีกีฌีซ!','ีฐีกีดีกีผ!','ีฉึีถีธึ','ีกีดีธึึ!','ีฐีธีพีซีฟ','ีนีธึีซีฏ!','ีฟีฆึีธึีฏ','ีขึีธีถีฆ','ีดีฟึีกีฏ','ีฑีพีกีฑึ!','ีฃีธึีฌีบีก','ีคีซีดีฅีฌ','ีขีฌึีกีฏ!','ีปีกีฐีฅีฌ!','ีญีกีนีฅีฌ','ีฅีฒึีถีซ','ีฉีกึีธีถ','ีฌีซีฝีฅีผ!','ีฐีกีณีกีญ!','ีฝีตีธึีชีฅ','ีกีถีฟีกีผ','ีฏีฅีผีซีฏ!','ีพีฟีกีถีฃ','ีฐีซีทีฅีฌ','ีฝึีผีธึ','ีฝีฟีซีถึ','ีญีฅีฌีกีผ!','ีขีฅึีฅีฌ!','ีฟีธีดีกีฟ','ีฅีฆีกีฏีซ','ีคีบึีธึ','ีฃีกีฆีกีถ','ีพีกึีซีน','ีกีถีฟีธึีถ!','ีฑีธีฒีซีฏ','ีกีถีพีกีญ!','ีฆีถีคีกีถ','ีฉีกึีธึึ','ีฃีธีผีกีฌ!','ึีธีฒีธึ','ีฐีธีฌีธีพ!','ีฝีกีฏีกีพ!','ีผีกีคีซีธ','ีบีซีฉีธีถ!','ีดีธีฎีกีฏ','ีฝีซีฃีกึ!','ีญีกีขีฅีฌ','ีฃีธึีทีกีฏ','ีฐึีกีทึ','ีกีฆีคีกีฏ','ึีกีฒึึ','ีฆีธีดีขีซ!','ีฎีฒึีซีค','ีฎีบีฟีธึีถ!','ีบีกีถีคีก','ีดึึีซีฏ','ีนีกึีธึีด!','ึีธึึีธึีด','ึีฎีตีกีฌ','ีฅีฒีถีซีฏ','ีดีฟึีธึีฏ!','ีดีธีคีฅีฌ!','ึีกีพีฅีฌ','ีฐีกีนีกีถ!','ีฟีธีฏีธีฝ','ีกีถีฝีฅีผ!','ีดีธีฒีฅีฝ','ึีฅีฉีกีฏ','ีขีกีฌีฅีฟ!','ีดีผีกีตีฌ','ีฉีฉีฅีถีซ','ีฉีกีฌีซีข!','ีคึีกึีซ!','ีผีธีขีธีฟ','ีขีกึีซึ','ีฝีถีคีซีฏ','ึีกึีกีญ','ีฏีถีณีซีผ','ีฌีซีถีฅีฌ!','ีญีทีทีธึ!','ีฐีธึีถีซีฝ','ีฏีกีฏีกีน','ีฐีธึีกีถ','ีพีกึีกีฆ','ีทีกึีกีถ','ีฉีทีทีธึ!','ีฏีพีกึึ!','ีบีกีบีซีฏ','ีฏีกีฒีซีถ','ีกีถีฑึึ','ีฏีกีพีกีฟ','ีฉีฅีถีซีฝ','ีคีกีฌีกึ','ีญีกึีกีถ!','ีนีพีฅึีฉ','ีฐีถีนีฅีฌ!','ีกีพีฅีฌีซ!','ึีกีพีธึ','ีถีทีฅีถีซ','ีบีกึีธีถ','ีฐีธึีดีธึ','ีบีฟีฟีฅีฌ','ีฎีถีธึีถีค','ีชีบีฟีกีฌ','ีฏีบีนีธึีถ','ีฝีบีกีฝึ','ีพีกีฆีฅีฌ','ีฎีกีฎีกีถ!','ีฏึึีธีฟ!','ีขีฅึีกีถ','ีกีถีคีธึึ!','ีขีธีพีฅีฌ!','ึีกีฉีฅีฉ','ีขีกีฌีซีฏ!','ีฝึีขีฅีฌ','ีณีกีทีฅีฌ','ีกีฟีกีฒีฑ','ีดีกีฝีธึึ','ีคีซีดีกึ!','ีฐีธึีฌีซีฝ','ีฟีญีดีกึ','ีคีกึีกีฏ','ีฏีธึีซีฆ','ีผีฅีชีซีด','ีพึีกึีซ','ีญีกีฒีกีฒ','ีฃึีฃีซีผ!','ีญีถีธึีซ','ีฏีกีบีธึ','ีฉีดีขีซีฏ!','ีบีกีฌีกีฟ!','ีธีฝีฏีธึ','ีฃีกีพีกีผ','ีกึีฉีธึีถ!','ีฎีฒีธีฟีฅ!','ีฐีกีพีกึ','ีกีฝีบีฅีฟ','ีฝีญีฟีธึ','ีฝึีซีฏีก','ีฉีกีฒีฅีฌ','ีฐีกีฝีธึีถ','ีฎีกึีกีพ','ีดีฅีญีกีฏ','ีคีธึีคีธึีฏ','ีฏีธีฒีกีฏ','ีขีกึีซีฏ','ีฌีฎีธึีค','ีฉีดึีกีฎ!','ีญีถีฑีธึ','ีถีฅีฟีฅีฌ','ีฃีซีฌีกีฝ!','ึึีฅีถึ','ีคึีธึีตีฉ','ีกีดึีกีฏ','ีฏีกึีฎึ','ีขีกีถีกีถ','ีกึีกึึ','ีฏีธีฏีธีฝ'];
  if (WORDS.length === 0) console.error("Word list is empty!");

  const sortedLetters = ['ีก', 'ีข', 'ีฃ', 'ีค', 'ีฅ', 'ีฆ', 'ีง', 'ีจ','ีฉ', 'ีช', 'ีซ', 'ีฌ', 'ีญ', 'ีฎ', 'ีฏ', 'ีฐ','ีฑ', 'ีฒ', 'ีณ', 'ีด', 'ีต', 'ีถ', 'ีท', 'ีธ','ีน', 'ีบ', 'ีป', 'ีผ', 'ีฝ', 'ีพ', 'ีฟ', 'ึ','ึ', 'ีธึ', 'ึ', 'ึ', 'ึ', 'ึ', 'ึ'];
  const allLetters = [...sortedLetters];
  const keyboardAlphabeticalLayout = [sortedLetters.slice(0, 8),sortedLetters.slice(8, 16),sortedLetters.slice(16, 24),sortedLetters.slice(24, 32),[...sortedLetters.slice(32), '']];
  const keyboardPhoneticLayout = [['ีง', 'ีฉ', 'ึ', 'ีฑ', 'ีป', 'ึ', 'ึ', 'ีน', 'ีณ', 'ีช'],['ึ', 'ีธ', 'ีฅ', 'ีผ', 'ีฟ', 'ีธึ', 'ีซ', 'ึ', 'ีบ', 'ีญ'],['ีก', 'ีฝ', 'ีค', 'ึ', 'ีฃ', 'ีฐ', 'ีต', 'ีฏ', 'ีฌ', 'ีฎ'],['ีฆ', 'ีฒ', 'ึ', 'ีพ', 'ีข', 'ีถ', 'ีด', 'ีท', 'ีจ', '']];
  const LAYOUT_NAMES = {'alphabetical': 'ิฑิฒิณ โจ๏ธ','phonetic': 'ิฑีิด โจ๏ธ'};

  let effectiveDateAtArmeniaMidnightAsUTC;
  let startDateAtArmeniaMidnightAsUTC;
  let todayAtArmeniaMidnightAsUTCGlobal;
  let isViewingPastGame = false;
  let targetWord;
  let parsedTarget;
  let dateKey;
  let effectiveDateStringForKey;
  let dayOffset;
  let gameNumber;
  let countdownInterval;

  function setupDateAndWord(dateParamString = null) {
      const startYear = parseInt(START_DATE_STRING.substring(0, 4));
      const startMonth = parseInt(START_DATE_STRING.substring(5, 7)) - 1;
      const startDay = parseInt(START_DATE_STRING.substring(8, 10));
      const startDateEpochUTC = Date.UTC(startYear, startMonth, startDay, 0, 0, 0, 0);
      startDateAtArmeniaMidnightAsUTC = startDateEpochUTC - ARMENIA_TIMEZONE_OFFSET_MS;

      const nowGlobalTimestamp = new Date().getTime();
      const nowInArmeniaVirtualDate = new Date(nowGlobalTimestamp + ARMENIA_TIMEZONE_OFFSET_MS);
      const todayCalendarDateInArmeniaEpochUTC = Date.UTC(
          nowInArmeniaVirtualDate.getUTCFullYear(),
          nowInArmeniaVirtualDate.getUTCMonth(),
          nowInArmeniaVirtualDate.getUTCDate(),
          0, 0, 0, 0
      );
      todayAtArmeniaMidnightAsUTCGlobal = todayCalendarDateInArmeniaEpochUTC - ARMENIA_TIMEZONE_OFFSET_MS;

      isViewingPastGame = false;
      if (dateParamString) {
          const parts = dateParamString.split('-');
          let requestedDateAtArmeniaMidnightAsUTC = NaN;
          if (parts.length === 3) {
               const reqYear = parseInt(parts[0]);
               const reqMonth = parseInt(parts[1]) - 1;
               const reqDay = parseInt(parts[2]);
               if (!isNaN(reqYear) && !isNaN(reqMonth) && !isNaN(reqDay)) {
                    const requestedCalendarDateEpochUTC = Date.UTC(reqYear, reqMonth, reqDay, 0, 0, 0, 0);
                    requestedDateAtArmeniaMidnightAsUTC = requestedCalendarDateEpochUTC - ARMENIA_TIMEZONE_OFFSET_MS;
               }
          }
          if (!isNaN(requestedDateAtArmeniaMidnightAsUTC) &&
              requestedDateAtArmeniaMidnightAsUTC <= todayAtArmeniaMidnightAsUTCGlobal &&
              requestedDateAtArmeniaMidnightAsUTC >= startDateAtArmeniaMidnightAsUTC) {
              effectiveDateAtArmeniaMidnightAsUTC = requestedDateAtArmeniaMidnightAsUTC;
              isViewingPastGame = true;
          } else {
              effectiveDateAtArmeniaMidnightAsUTC = todayAtArmeniaMidnightAsUTCGlobal;
              isViewingPastGame = false;
              if (window.history.replaceState) {
                   window.history.replaceState(null, '', window.location.pathname);
              }
          }
      } else {
          effectiveDateAtArmeniaMidnightAsUTC = todayAtArmeniaMidnightAsUTCGlobal;
          isViewingPastGame = false;
      }

      const diffMillis = effectiveDateAtArmeniaMidnightAsUTC - startDateAtArmeniaMidnightAsUTC;
      dayOffset = diffMillis >= 0 ? Math.floor(diffMillis / (1000 * 60 * 60 * 24)) : -1;
      gameNumber = dayOffset + 1;

      const dailyTargetWords = WORDS.filter(word => !word.endsWith('!'));
      if (dailyTargetWords.length === 0) {
           targetWord = "ีฝีญีกีฌ"; dayOffset = -1; gameNumber = '?';
      } else if (dayOffset < 0) {
           targetWord = "ีฝีญีกีฌ"; gameNumber = '?';
      } else {
           targetWord = dailyTargetWords[dayOffset % dailyTargetWords.length];
      }
      parsedTarget = splitWord(targetWord);

      const effectiveCalendarDateInArmenia = new Date(effectiveDateAtArmeniaMidnightAsUTC + ARMENIA_TIMEZONE_OFFSET_MS);
      const keyYear = effectiveCalendarDateInArmenia.getUTCFullYear();
      const keyMonth = String(effectiveCalendarDateInArmenia.getUTCMonth() + 1).padStart(2, '0');
      const keyDay = String(effectiveCalendarDateInArmenia.getUTCDate()).padStart(2, '0');
      effectiveDateStringForKey = `${keyYear}-${keyMonth}-${keyDay}`;
      dateKey = `armenianWordle-${effectiveDateStringForKey}`;

      gameNumberDisplay.textContent = `ิฝีกีฒ #${gameNumber}`;
      gameNumberDisplay.title = isViewingPastGame ?
          `ิดีซีฟีธึีด ีฅึ ${effectiveDateStringForKey} ีญีกีฒีจ (ีีกีตีกีฝีฟีกีถีซ ีชีกีดีกีถีกีฏีธีพ)ึ ีีฅีฒีดีฅึี ีขีกึีฅีฌีธึ ีบีกีฟีดีธึีฉีตีธึีถีจึ` :
          `ีีฅีฒีดีฅึี ีฟีฅีฝีถีฅีฌีธึ ีกีถึีกีฎ ีญีกีฒีฅึีจ (ีีกีตีกีฝีฟีกีถีซ ีชีกีดีกีถีกีฏีธีพ)ึ`;
  }

  let guesses = [];
  let currentGuess = [];
  let currentRowIndex = 0;
  let isGameOver = false;
  let messageTimeout;
  let keyStatuses = {};
  let currentLayoutName = localStorage.getItem(LOCAL_STORAGE_LAYOUT_KEY) || 'phonetic';
  let currentLayout = (currentLayoutName === 'phonetic') ? keyboardPhoneticLayout : keyboardAlphabeticalLayout;

  function saveState() {
    const state = { guesses, currentRowIndex, isGameOver, targetWord, keyStatuses };
    localStorage.setItem(dateKey, JSON.stringify(state));
    localStorage.setItem(LOCAL_STORAGE_LAYOUT_KEY, currentLayoutName);

    const isEffectiveDateTodayInArmenia = effectiveDateAtArmeniaMidnightAsUTC === todayAtArmeniaMidnightAsUTCGlobal;
    if (isGameOver && isEffectiveDateTodayInArmenia) {
        try {
            let history = JSON.parse(localStorage.getItem(LOCAL_STORAGE_HISTORY_KEY) || '[]');
            if (!Array.isArray(history)) history = [];
            const existingEntryIndex = history.findIndex(entry => entry.date === effectiveDateStringForKey);
            const newEntry = { date: effectiveDateStringForKey, number: gameNumber };
            if (existingEntryIndex > -1) history[existingEntryIndex] = newEntry;
            else history.push(newEntry);
            history.sort((a, b) => (a.date < b.date) ? 1 : ((a.date > b.date) ? -1 : (b.number - a.number)));
            localStorage.setItem(LOCAL_STORAGE_HISTORY_KEY, JSON.stringify(history));
        } catch (e) { console.error("Error saving game history:", e); }
    }
  }

  function loadState() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.classList.toggle('dark', savedTheme === 'dark');
    toggleBtnTheme.textContent = savedTheme === 'dark' ? 'โ๏ธ' : '๐';

    const savedLayoutName = localStorage.getItem(LOCAL_STORAGE_LAYOUT_KEY) || 'phonetic';
    currentLayoutName = (LAYOUT_NAMES[savedLayoutName]) ? savedLayoutName : 'phonetic';
    currentLayout = (currentLayoutName === 'phonetic') ? keyboardPhoneticLayout : keyboardAlphabeticalLayout;
    toggleBtnLayout.textContent = LAYOUT_NAMES[currentLayoutName];
    document.body.setAttribute('data-keyboard-layout', currentLayoutName);

    const savedStateJSON = localStorage.getItem(dateKey);
    if (savedStateJSON) {
        try {
            const savedState = JSON.parse(savedStateJSON);
            guesses = savedState.guesses || [];
            currentRowIndex = savedState.currentRowIndex || 0;
            isGameOver = savedState.isGameOver || false;
            keyStatuses = savedState.keyStatuses || {};
            for (const key in keyStatuses) {
               if (!['correct', 'present', 'absent', null].includes(keyStatuses[key])) delete keyStatuses[key];
            }
        } catch (e) {
            console.error(`Error loading saved state for ${dateKey}:`, e);
            resetGameStateVars(); isGameOver = false;
        }
    } else {
        resetGameStateVars(); isGameOver = false;
    }
    currentGuess = [];
  }

  function init() {
    if (countdownInterval) clearInterval(countdownInterval);

    const urlParams = new URLSearchParams(window.location.search);
    const dateParam = urlParams.get('date');
    setupDateAndWord(dateParam);
    loadState();

    buildBoard();
    buildKeyboard();
    redrawBoardFromState();
    updateKeyboardHighlight();

    if (isGameOver) {
        disableInput();
        const lastGuessString = guesses.length > 0 ? guesses[guesses.length - 1].map(g => g.letter).join('') : '';
        // Ensure targetWord is defined. If loaded from state, it might be in the state object.
        const loadedState = localStorage.getItem(dateKey) ? JSON.parse(localStorage.getItem(dateKey)) : null;
        const wordForMessage = (loadedState && loadedState.targetWord) ? loadedState.targetWord : targetWord;
        
        const wonGame = splitWord(lastGuessString).join('') === splitWord(wordForMessage).join('');

        if (!isViewingPastGame) { // Only for current day's game
            startNextWordCountdown(wonGame); // Pass true if won, false if lost (and game over)
        } else { // For past games
            if (wonGame) {
                showMessage('๐ ีีกีฒีฉีกีถีกีฏ ๐', 0);
            } else {
                 showMessage(`ิฝีกีฒีถ ีกีพีกึีฟีพีกีฎ ีงึ ิฒีกีผีจี ${wordForMessage}`, 0);
            }
        }
    } else {
        if (isViewingPastGame) {
             showMessage(`ิฝีกีฒ #${gameNumber} (${effectiveDateStringForKey})`, 3000);
        }
    }

    window.addEventListener('keydown', handlePhysicalKey);
    toggleBtnLayout.addEventListener('click', switchLayout);
    gameNumberDisplay.addEventListener('click', openPastGamesPopup);
    popupCloseButton.addEventListener('click', closePastGamesPopup);
    pastGamesPopup.addEventListener('click', (e) => {
        if (e.target === pastGamesPopup) closePastGamesPopup();
    });
  }

  function resetGameStateVars() {
      guesses = []; currentGuess = []; currentRowIndex = 0; keyStatuses = {};
  }

   function splitWord(word) {
    const chars = []; const lowerWord = String(word || '').toLowerCase();
    for (let i = 0; i < lowerWord.length; i++) {
      if (lowerWord[i] === 'ีธ' && i + 1 < lowerWord.length && lowerWord[i + 1] === 'ึ') {
        chars.push('ีธึ'); i++;
      } else { chars.push(lowerWord[i]); }
    } return chars;
   }

  function buildBoard() {
    boardElement.innerHTML = '';
    for (let i = 0; i < MAX_ROWS; i++) {
        const row = document.createElement('div'); row.className = 'row';
        for (let j = 0; j < WORD_LENGTH; j++) {
            const tile = document.createElement('div'); tile.className = 'tile';
            tile.innerHTML = '<div></div>'; row.appendChild(tile);
        } boardElement.appendChild(row);
    }
  }

  function buildKeyboard() {
    keyboardTopRowElement.innerHTML = ''; keyboardMainGridElement.innerHTML = '';
    [ENTER_KEY, DELETE_KEY].forEach(keyText => {
        const keyEl = document.createElement('button'); keyEl.textContent = keyText; keyEl.className = 'key';
        if (keyText === ENTER_KEY) { keyEl.classList.add('enter'); keyEl.onclick = handleSubmit; }
        else { keyEl.classList.add('delete'); keyEl.onclick = handleDelete; }
        keyboardTopRowElement.appendChild(keyEl);
    });
    currentLayout.forEach(rowKeys => {
        rowKeys.forEach(keyText => {
            const keyEl = document.createElement('button'); keyEl.textContent = keyText; keyEl.className = 'key';
            if (!keyText) { keyEl.classList.add('placeholder'); keyEl.disabled = true; keyEl.style.cursor = 'default'; keyEl.dataset.key = ''; }
            else { keyEl.dataset.key = keyText; keyEl.onclick = () => handleKeyClick(keyText); }
            keyboardMainGridElement.appendChild(keyEl);
        });
    });
    document.body.setAttribute('data-keyboard-layout', currentLayoutName);
  }

  function switchLayout() {
      currentLayoutName = (currentLayoutName === 'phonetic') ? 'alphabetical' : 'phonetic';
      currentLayout = (currentLayoutName === 'phonetic') ? keyboardPhoneticLayout : keyboardAlphabeticalLayout;
      toggleBtnLayout.textContent = LAYOUT_NAMES[currentLayoutName];
      buildKeyboard(); adjustBoardSize(); updateKeyboardHighlight();
      localStorage.setItem(LOCAL_STORAGE_LAYOUT_KEY, currentLayoutName);
  }

  function redrawBoardFromState() {
     boardElement.querySelectorAll('.row').forEach((row, rIdx) => {
        const tiles = row.querySelectorAll('.tile');
        if (rIdx < guesses.length) {
             const guessData = guesses[rIdx];
             tiles.forEach((tile, tIdx) => {
                const tileInner = tile.querySelector('div'); if (!tileInner) return;
                const letterData = guessData[tIdx] || { letter: '', status: '' };
                tileInner.textContent = letterData.letter;
                tile.classList.remove('correct', 'present', 'absent', 'filled');
                if (letterData.letter) { tile.classList.add('filled'); if (letterData.status) tile.classList.add(letterData.status); }
             });
        } else { tiles.forEach(tile => { const ti = tile.querySelector('div'); if (ti) ti.textContent = ''; tile.classList.remove('correct', 'present', 'absent', 'filled'); }); }
     });
      if (currentRowIndex < MAX_ROWS && currentRowIndex >= guesses.length) updateCurrentRowDisplay();
  }

  function updateCurrentRowDisplay() {
    if (isGameOver || currentRowIndex >= MAX_ROWS) return;
    const curRow = boardElement.querySelectorAll('.row')[currentRowIndex]; if (!curRow) return;
    curRow.querySelectorAll('.tile').forEach((tile, idx) => {
        const tileInner = tile.querySelector('div'); if (!tileInner) return;
        const letter = currentGuess[idx] || ''; tileInner.textContent = letter;
        tile.classList.toggle('filled', !!letter); tile.classList.remove('correct', 'present', 'absent');
    });
  }

  function updateKeyboardHighlight() {
    keyboardElement.querySelectorAll('.key[data-key]').forEach(keyEl => {
        const letter = keyEl.dataset.key; if (!letter) return;
        const status = keyStatuses[letter]; keyEl.classList.remove('correct', 'present', 'absent', 'has-present');
        if (status) keyEl.classList.add(status);
    });
  }

  function handleKeyClick(key) {
    if (isGameOver || currentGuess.length >= WORD_LENGTH) return;
    currentGuess.push(key); updateCurrentRowDisplay();
  }
  function handleDelete() {
    if (isGameOver || currentGuess.length === 0) return;
    currentGuess.pop(); updateCurrentRowDisplay();
  }

  function handleSubmit() {
    if (isGameOver) return;
    if (currentGuess.length !== WORD_LENGTH) { shakeRow(currentRowIndex); showMessage("ิฑีถีขีกีพีกึีกึ ีฟีกีผีฅึีซ ึีกีถีกีฏ", 1500); return; }
    const guessStr = currentGuess.join('');
    const isValid = WORDS.includes(guessStr) || WORDS.includes(guessStr + '!');
    if (!isValid) { shakeRow(currentRowIndex); showMessage("ีีพีตีกีฌ ีขีกีผีจ ีดีฅึ ีขีกีผีกึีกีถีธึีด ีนีฏีก :(", 1500); return; }

    const result = checkGuess(guessStr); guesses.push(result);
    result.forEach(({ letter, status }) => {
        const curStat = keyStatuses[letter];
        if (status === 'correct') keyStatuses[letter] = 'correct';
        else if (status === 'present' && curStat !== 'correct') keyStatuses[letter] = 'present';
        else if (status === 'absent' && !curStat) keyStatuses[letter] = 'absent';
    });
    animateGuessResult(currentRowIndex, result); updateKeyboardHighlight();
    setTimeout(() => {
        currentRowIndex++; currentGuess = [];
        checkWinLoss(guessStr); // This now handles countdown initiation
        saveState();
    }, WORD_LENGTH * 150 + 300);
  }

  function handlePhysicalKey(e) {
     if (isGameOver) return; let key = e.key;
     if (e.altKey||e.ctrlKey||e.metaKey||key.startsWith('F')||(key.length > 1 && !['Backspace','Delete','Enter'].includes(key))) return;
     key = key.toLowerCase();
     if (key === 'enter') handleSubmit();
     else if (key === 'backspace' || key === 'delete') handleDelete();
     else if (allLetters.includes(key)) handleKeyClick(key);
  }

  function checkGuess(guessString) {
     const guessChars = splitWord(guessString); const result = []; const targetCopy = [...parsedTarget];
     for(let i=0; i<WORD_LENGTH; i++) result[i] = { letter: guessChars[i], status: '' };
     for (let i=0; i<WORD_LENGTH; i++) if (guessChars[i] === parsedTarget[i]) { result[i].status = 'correct'; targetCopy[i] = null; }
     for (let i=0; i<WORD_LENGTH; i++) {
         if (result[i].status === 'correct') continue; const letter = guessChars[i];
         const idxInTarget = targetCopy.indexOf(letter);
         if (idxInTarget !== -1) { result[i].status = 'present'; targetCopy[idxInTarget] = null; }
         else { result[i].status = 'absent'; }
     } return result;
  }

  function checkWinLoss(lastGuessString) {
     const wonGame = splitWord(lastGuessString).join('') === parsedTarget.join('');
     const lostGameByRunningOutOfRows = currentRowIndex >= MAX_ROWS;

     if (wonGame) {
         isGameOver = true;
         disableInput();
         if (!isViewingPastGame) {
            startNextWordCountdown(true); // true for win
         } else {
            showMessage('๐ ีีกีฒีฉีกีถีกีฏ ๐', 0);
         }
     } else if (lostGameByRunningOutOfRows) {
          isGameOver = true;
          disableInput();
          if (!isViewingPastGame) {
            startNextWordCountdown(false); // false for loss
          } else {
            // For past games, show the target word on loss
            showMessage(`ีีกึีฟีธึีฉีตีธึีถึ ิฒีกีผีจี ${targetWord}`, 0);
          }
     }
     // No 'else' here; game continues if neither win nor max rows reached
  }

  function disableInput() {
     isGameOver = true; window.removeEventListener('keydown', handlePhysicalKey);
     keyboardElement.querySelectorAll('.key').forEach(btn => {
         if (btn.classList.contains('enter')||btn.classList.contains('delete')||btn.dataset.key) { btn.onclick = null; btn.style.cursor = 'default'; }
     });
  }

  function animateGuessResult(rowIndex, result) {
     const row = boardElement.querySelectorAll('.row')[rowIndex]; if (!row) return;
     row.querySelectorAll('.tile').forEach((tile, index) => {
         const { letter, status } = result[index]; const tileInner = tile.querySelector('div'); if (!tileInner) return;
         tileInner.textContent = letter; tile.classList.add('filled'); tile.classList.remove('correct', 'present', 'absent');
         setTimeout(() => { if (status) tile.classList.add(status); }, index * 150);
     });
  }

  function shakeRow(rowIndex) {
    const row = boardElement.querySelectorAll('.row')[rowIndex];
    if (row) { row.classList.add('shake'); row.addEventListener('animationend', () => row.classList.remove('shake'), { once: true });}
  }

   function showMessage(msg, duration = 2000) {
        if (duration !== 0 && countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
        clearTimeout(messageTimeout); messageElement.textContent = msg; messageElement.classList.add('show');
        if (duration > 0) { messageTimeout = setTimeout(() => messageElement.classList.remove('show'), duration); }
   }

  function startNextWordCountdown(isWin) { // Accepts boolean isWin
    if (countdownInterval) clearInterval(countdownInterval);

    const nextMidnightArmeniaAsUTC = todayAtArmeniaMidnightAsUTCGlobal + (24 * 60 * 60 * 1000);

    function updateCountdownDisplay() {
        const nowUTCTimestamp = new Date().getTime();
        const timeRemainingMs = nextMidnightArmeniaAsUTC - nowUTCTimestamp;

        let prefixMessage = "";
        let timeUpMessage = "";

        if (isWin) {
            prefixMessage = "๐ ีีกีฒีฉีกีถีกีฏ ๐ ";
            timeUpMessage = "๐ ีีกีฒีฉีกีถีกีฏ ๐ ีีกีปีธึีค ีขีกีผีจ ีฐีกีฝีกีถีฅีฌีซ ีงึ ินีกึีดีกึึีฅึ ีงีปีจึ";
        } else {
            // For loss, include the target word in the prefix.
            // targetWord is globally available from setupDateAndWord
            prefixMessage = `ีีกึีฟีธึีฉีตีธึีถึ ิฒีกีผีจี ${targetWord}ึ `;
            timeUpMessage = `ีีกึีฟีธึีฉีตีธึีถึ ีีกีปีธึีค ีขีกีผีจ ีฐีกีฝีกีถีฅีฌีซ ีงึ ินีกึีดีกึึีฅึ ีงีปีจึ`;
        }

        if (timeRemainingMs <= 0) {
            showMessage(timeUpMessage, 0);
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = null;
            return;
        }

        const hours = Math.floor((timeRemainingMs / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((timeRemainingMs / (1000 * 60)) % 60);
        const seconds = Math.floor((timeRemainingMs / 1000) % 60);
        const hStr = String(hours).padStart(2, '0');
        const mStr = String(minutes).padStart(2, '0');
        const sStr = String(seconds).padStart(2, '0');

        messageElement.textContent = `${prefixMessage}ีีกีปีธึีค ีขีกีผีจี ${hStr}:${mStr}:${sStr}-ีซึ`;
        if (!messageElement.classList.contains('show')) {
            messageElement.classList.add('show');
        }
    }
    updateCountdownDisplay();
    countdownInterval = setInterval(updateCountdownDisplay, 1000);
  }

  toggleBtnTheme.onclick = () => {
    const isDark = document.body.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    toggleBtnTheme.textContent = isDark ? 'โ๏ธ' : '๐';
  };

  function openPastGamesPopup() {
      try {
          pastGamesList.innerHTML = '';
          if (isNaN(startDateAtArmeniaMidnightAsUTC) || startDateAtArmeniaMidnightAsUTC > todayAtArmeniaMidnightAsUTCGlobal) {
               pastGamesList.innerHTML = `<li>ิฝีกีฒีฅึีจ ีฝีฏีฝีพีธึีด ีฅีถ ${START_DATE_STRING}-ีซึ (ีีกีตีกีฝีฟีกีถีซ ีชีกีดีกีถีกีฏีธีพ)ึ</li>`;
               pastGamesPopup.style.display = 'flex'; return;
          }
          const todayOffsetInArmenia = Math.floor((todayAtArmeniaMidnightAsUTCGlobal - startDateAtArmeniaMidnightAsUTC) / (1000 * 60 * 60 * 24));
          const todaysGameNumberInArmenia = todayOffsetInArmenia + 1;

          if (todaysGameNumberInArmenia < 1) { pastGamesList.innerHTML = '<li>ิฝีกีฒีฅึีซ ึีธึึีกีฏีจ ีฝีฟีฅีฒีฎีฅีฌีซีฝ ีฝีญีกีฌึ</li>'; }
          else {
              const items = [];
              for (let i = 1; i <= todaysGameNumberInArmenia; i++) {
                  const gameOffset = i - 1;
                  const gameDateIterAtArmeniaMidAsUTC = startDateAtArmeniaMidnightAsUTC + (gameOffset * 1000 * 60 * 60 * 24);
                  const gameCalDateInArmenia = new Date(gameDateIterAtArmeniaMidAsUTC + ARMENIA_TIMEZONE_OFFSET_MS);
                  const y = gameCalDateInArmenia.getUTCFullYear();
                  const m = String(gameCalDateInArmenia.getUTCMonth() + 1).padStart(2, '0');
                  const d = String(gameCalDateInArmenia.getUTCDate()).padStart(2, '0');
                  const gameDateStrInArmenia = `${y}-${m}-${d}`;
                  const li = document.createElement('li'); const a = document.createElement('a');
                  a.href = `${window.location.pathname}?date=${gameDateStrInArmenia}`;
                  a.textContent = `ิฝีกีฒ #${i} - ${gameDateStrInArmenia}`; a.title = `ิดีซีฟีฅีฌ ${gameDateStrInArmenia} ีญีกีฒีจ`;
                  if (gameDateStrInArmenia === effectiveDateStringForKey) a.style.fontWeight = 'bold';
                  li.appendChild(a); items.push(li);
              } items.reverse().forEach(item => pastGamesList.appendChild(item));
          } pastGamesPopup.style.display = 'flex';
      } catch (e) {
          console.error("Error generating past games list:", e);
          pastGamesList.innerHTML = '<li>ีีกีฟีดีธึีฉีตีธึีถีจ ีขีฅีผีถีฅีฌีซีฝ ีฝีญีกีฌ ีฟีฅีฒีซ ีธึีถีฅึีกีพึ</li>';
          pastGamesPopup.style.display = 'flex';
      }
  }

  function closePastGamesPopup() { pastGamesPopup.style.display = 'none'; }

  function adjustBoardSize() {
      const vh = window.innerHeight; const hc = document.querySelector('.header-container');
      const sub = document.querySelector('.subtitle'); const kbd = document.getElementById('keyboard');
      const mcs = getComputedStyle(mainContent); const bc = document.querySelector('.board-container');
      if (!hc || !sub || !kbd || !bc || !boardElement || !mainContent) return;
      let nbh = 0; [hc, sub, kbd].forEach(el => { const s = getComputedStyle(el); nbh += el.offsetHeight + (parseFloat(s.marginTop)||0) + (parseFloat(s.marginBottom)||0); });
      nbh += (parseFloat(mcs.paddingTop)||0) + (parseFloat(mcs.paddingBottom)||0);
      const bcs = getComputedStyle(bc); const bcvm = (parseFloat(bcs.marginTop)||0) + (parseFloat(bcs.marginBottom)||0);
      const abh = vh - nbh - bcvm; const bs = getComputedStyle(boardElement);
      const rg = parseFloat(bs.rowGap)||0; const cg = parseFloat(bs.columnGap)||0; const buf = 8;
      const maxTSizeH = Math.max(0, (abh - (MAX_ROWS-1)*rg - buf) / MAX_ROWS);
      const reqBWH = (WORD_LENGTH * maxTSizeH) + (WORD_LENGTH-1)*cg;
      const tMW = bc.style.maxWidth; bc.style.maxWidth = '';
      const cssMWBC = parseFloat(getComputedStyle(bc).maxWidth);
      const mcMW = parseFloat(mcs.maxWidth)||Infinity;
      const finalCssMW = Math.min(isNaN(cssMWBC) ? Infinity : cssMWBC, mcMW);
      bc.style.maxWidth = tMW;
      const targetW = Math.min(reqBWH, finalCssMW);
      const minRTSize = 30; const minRBW = (WORD_LENGTH*minRTSize) + (WORD_LENGTH-1)*cg;
      if (targetW > minRBW && targetW > 0) bc.style.maxWidth = `${targetW}px`;
      else bc.style.maxWidth = '';
  }

  document.addEventListener('DOMContentLoaded', () => { init(); adjustBoardSize(); });
  window.addEventListener('resize', adjustBoardSize);

</script>

</body>
</html>
